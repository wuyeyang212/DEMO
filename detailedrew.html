<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <!-- <link rel="stylesheet" href="css/amazeui.css">
    <link rel="stylesheet" href="css/app.css"> -->
    <!-- 弹窗CSS -->
    <link rel="stylesheet" href="css/isPop.css">
    <link rel="stylesheet" href="css/base.css">
    <!--模糊搜索 style="background:#eef4f9"-->
    <link rel="stylesheet" href="css/jquery-ui-1.9.2.custom.css">
    <style>
        @font-face {
            font-family: 'fonping';
            src: url(font/PINGFANGREGULAR.TTF);
        }

        body {
            font-family: 'fonping', "Segoe UI", "Lucida Grande", Helvetica, Arial, "Microsoft YaHei", "FreeSans, Arimo", "Droid Sans", "wenquanyi micro hei", "Hiragino Sans GB", "Hiragino Sans GB W3", "FontAwesome", sans-serif
        }

        .ui-autocomplete {
            max-height: 120px;
            overflow-y: auto;

            overflow-x: hidden;

        }

        .ui-autocomplete::-webkit-scrollbar {
            /*!*滚动条整体样式*!*/
            width: 8px;
            /*!*高宽分别对应横竖滚动条的尺寸*!*/
            height: 1px;
        }

        .ui-autocomplete::-webkit-scrollbar-thumb {
            /*!*滚动条里面小方块*!*/
            border-radius: 8px;
            background: #D4DFEA;
        }

        /* .ui-autocomplete::-webkit-scrollbar-track {
            !*滚动条里面轨道*!
            border: 1px solid #D4DFEA;
            border-radius: 8px;
        } */

        .ui-widget {
            font-family: "PingFang SC", "Segoe UI", "Lucida Grande", Helvetica, Arial, "Microsoft YaHei", "FreeSans, Arimo", "Droid Sans", "wenquanyi micro hei", "Hiragino Sans GB", "Hiragino Sans GB W3", "FontAwesome", sans-serif
        }

        .heconellipsis {
            max-width: 250px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
    
    </style>

</head>

<body>

    <div class="container" id="container">


        <div class="logo">
            <div>
                <img class="img" src="./image/xiugai.png" alt="">
                <span class="title">病案首页智能质控</span>
            </div>
        </div>


        <div class="information">
            <div style="float: left;margin-right: 8px;width: 240px;">
                <div>
                    <span class="left" style="letter-spacing:3px;">病案号</span>
                    <span class="left">：</span>
                    <span class="right" id="mId">外2019070500032643</span>
                </div>
                <div>
                    <span class="left nameLat">姓名</span>
                    <span class="left">：</span>
                    <span class="right" id="name">吴竞波</span>
                </div>
                <div>
                    <span class="left">参保类型：</span>
                    <span class="right" id="claimType">职工医保</span>
                </div>
            </div>
            <div style="float: left;margin-right: 8px;width: 300px;">
                <div>
                    <span class="left">入组情况：</span>
                    <span class="right" id="guoupInfo">外2019070500032643</span>
                </div>
                <div>
                    <span class="left">主要诊断：</span>
                    <span class="right" id="diagnose">K25.9</span>
                </div>
                <div>
                    <span class="left">主要操作：</span>
                    <span class="right" id="operation">42.41(部分食管切除术)</span>
                </div>
            </div>
            <div style="float: left;margin-right: 8px;width: 200px;">
                <div>
                    <!-- <span class="left" style="letter-spacing:3px;">DRG支付标准</span> -->
                    <span class="left" style="letter-spacing:3px;">权重</span>
                    <span class="left">：</span>
                    <span class="right" id="drgAmount">2000</span>
                    <!-- <span class="right">元</span> -->
                </div>
                <!--<div>-->
                <!--<span class="left">DRG基金支付标准：</span>-->
                <!--<span class="right" id="drgFundAmount">2300</span>-->
                <!--<span class="right">元</span>-->
                <!--</div>-->
                <div>
                    <span class="left cost">医疗总费用</span>
                    <span class="left">：</span>
                    <span class="right" id="totalAmount">5300</span>
                    <span class="right">元</span>
                </div>
            </div>
            <div class="compatible">
                <div>
                    <span class="left allGrade">质量评分：</span>
                    <span class="grade" id="score">87</span>
                    <span class="left code">分</span>
                </div>

            </div>

            <div class="line">
            </div>
        </div>


        <div class="tabbar">

            <ul class="tab">
                <li class="active" style="position:relative;">
                    <span>完整性校验</span>
                    <span class="item" id="fullCheck"></span>
                </li>
                <li style="position:relative;">
                    <span>逻辑性校验</span>
                    <span class="item" id="logicCheck"></span>
                </li>
                <li style="position:relative;">
                    <span>DRG校验</span>
                    <span class="item" id="alldrgCheck"></span>
                </li>
            </ul>

            <ul class="content" id="content">
                <li style="display: block;">
                    <div class="theOne">

                        <table class="dg oneTable" cellspacing="0">
                            <thead>
                                <tr class="blueTr">
                                    <th style="width: 300px;text-align: center;line-height: 45px;">违规</th>
                                    <th style="width: 300px;text-align: center;line-height:45px;">规则内容</th>
                                    <th style="width: 340px;text-align: center;line-height: 45px;">修改</th>
                                </tr>
                            </thead>
                            <tbody id="fullCheckResult"></tbody>
                        </table>
                    </div>
                </li>

                <li>
                    <div class="theOne">

                        <table class="dg oneTable" cellspacing="0">
                            <thead>
                                <tr class="blueTr">
                                    <th style="text-align: center;line-height: 45px;">违规</th>
                                    <th style="text-align: center;line-height: 45px;">规则内容</th>
                                    <th style="text-align: center;line-height: 45px;">修改</th>
                                </tr>
                            </thead>
                            <tbody id="logicCheckResult"></tbody>

                        </table>
                    </div>
                </li>

                <li>
                    <div>
                        <div class="lightHeight" id="unreasonable">
                            不合理原因：<span id="unreasontext"></span>
                        </div>

                        <div class="connTables">
                            <table class="dg leftText" cellspacing="0">
                                <thead>
                                    <tr class="blueTr">
                                        <th style="width: 120px;">字段名</th>
                                        <th style="width: 250px;">医院版ICD-10</th>
                                        <th style="width: 250px;">医保版ICD-10</th>
                                        <th style="width: 230px">修改</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="drgDiagnoseFieldResult"></tbody>

                            </table>

                            <table class="dg leftText" cellspacing="0">
                                <thead>
                                    <tr class="blueTr">
                                        <th style="width: 120px">字段名</th>
                                        <th style="width: 250px">医院版ICD-9</th>
                                        <th style="width: 250px">医保版ICD-9</th>
                                        <th style="width: 230px">修改</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="drgOperationFieldResult"></tbody>
                            </table>
                        </div>
                    </div>
                </li>
            </ul>

            <ul style="margin-top:40px;">
                <div style="float: left;">
                    <img src="image/warning.png" alt="">
                    <span>预警：必填</span>
                    <br>
                    <img src="image/tips.png" alt="">
                    <span>提示：满足相关要求后可不修改</span>
                </div>
                <div style="float: right;">
                    <button onclick="getDRGContent()" class="bgc">效验</button>
                    <button onclick="commitDRGContent()" class="Baocun">提交</button>
                </div>
            </ul>

        </div>

        <!-- 悬浮层 -->
        <!-- <div class="popover">
            【{ZA2}】不用于根本死因的编码，因此当患者死亡后，不可作为【主要诊断=编码】。
        </div> -->


    </div>









</body>
<!-- import jquery -->
<script src="js/jquery-1.8.3.js"></script>

<script src="js/jquery.cssforms.js"></script>

<!--模糊搜索-->
<script src="js/jquery-ui-1.9.2.custom.js"></script>

<script src="js/region_select.js"></script>
<script src="js/json2.js"></script>
<script>
    const URL_TWO = 'http://192.168.3.135:8082/'
    $(function () {



        //选项卡
        $('.tab').find('li').click(function () {
            var index = $(this).index();
            $(this).addClass('active').siblings().removeClass('active');
            $('.content').find('li').eq(index).show().siblings().hide();
        })


        /**
         * 为 上移 、下移 按钮绑定点击事件
         */
        $("body").on("click", ".moveUpOrDown", function () {
            var text = $(this).text();
            if (text == "上移") {
                var prevTr = $(this).parent().parent().prevAll();
                var SMOtable = $(this).parent().parent().parent();


                if (prevTr.length > 0) {
                    var preTemp = prevTr.first();
                    var thisHr = $(this).parent().parent();

                    thisHr.replaceWith("<tr>" + preTemp.html() + "</tr>");
                    preTemp.replaceWith("<tr>" + thisHr.html() + "</tr>");

                }
                var trsyu = SMOtable.find("tr");
                var suiCui = trsyu.eq(0).children('td:eq(0)').text();
                SortTdName(SMOtable, suiCui)
            } else if (text == "下移") {
                var nextTr = $(this).parent().parent().next();
                var SMOtable = $(this).parent().parent().parent();
                if (nextTr.length > 0) {
                    var thisHr = $(this).parent().parent();
                    thisHr.replaceWith("<tr>" + nextTr.html() + "</tr>");
                    nextTr.replaceWith("<tr>" + thisHr.html() + "</tr>");
                }

                var trsyu = SMOtable.find("tr");
                var suiCui = trsyu.eq(0).children('td:eq(0)').text();
                SortTdName(SMOtable, suiCui)

            } else if (text == "置顶") {
                var top = $(this).parents("tr")
                var SMOtable = $(this).parent().parent().parent();
                var trsyu = SMOtable.find("tr");
                var suiCui = trsyu.eq(0).children('td:eq(0)').text();

                SMOtable.prepend(top)
                SortTdName(SMOtable, suiCui)
            }
        });

        function SortTdName(sui, TableName) {
            var trsyu = sui.find("tr");
            if (TableName == "门(急)诊诊断" || TableName == "主要诊断") {
                trsyu.each(function (el, index) {

                    if (el == 0) {
                        $(this).children('td:eq(0)').text('主要诊断')
                    } else {
                        $(this).children('td:eq(0)').text('其他诊断' + el)
                    }
                    //  else if (11 < el && el < 15) {
                    //     $(this).children('td:eq(0)').text('病理诊断' + (el - 11))
                    // } else if (14 < el && el < 17) {
                    //     $(this).children('td:eq(0)').text('损伤、中毒外部原因' + (el - 14))
                    // }

                })
            } else {
                trsyu.each(function (el, index) {

                    if (el == 0) {

                        $(this).children('td:eq(0)').text('主要手术操作')
                    } else {
                        $(this).children('td:eq(0)').text('其他手术操作' + el)
                    }

                })
            }


        }
    })

    Array.prototype.in_array = function (element) {

        for (var i = 0; i < this.length; i++) {

            if (this[i] == element) {

                return true;

            }

        }
        return false;

    }





    // 数据渲染
    function dataShowing(newData, d) {
        console.log(newData)
        // 数据
        $('#mId').text(newData.mId)
        $('#name').text(newData.name)
        $('#claimType').text(newData.claimType)
        $('#guoupInfo').text(newData.groupInfo)
        $('#diagnose').text(newData.diagnose)
        $('#operation').text(newData.operation)
        $('#drgAmount').text(newData.weight)
        // $('#drgFundAmount').text(newData.drgFundAmount)
        $('#totalAmount').text(d)
        $('#score').text(newData.score)
        //消息提醒
        $('#fullCheck').text(newData.fullCheckResult.length)
        $('#logicCheck').text(newData.logicCheckResult.length)
        $('#alldrgCheck').text(newData.drgCheckResult.length)
        //不合理原因
        var unreasonableStr = '';
        //关于显示不理原因诊断集合的数组
        var arrS = [];
        for (var i = 0; i < newData.drgCheckResult.length; i++) {
            arrS.push(newData.drgCheckResult[i].fId)
            unreasonableStr += "<span>" + newData.drgCheckResult[i].reason + "</span>"
        }

        $("#unreasontext").append(unreasonableStr)
        //优先选择的阵容
        var preference = [];
        if (newData.drgCheckResult.length > 0) {
            for (var i = 0; i < newData.drgCheckResult.length; i++) {
                preference.push(newData.drgCheckResult[i].fId)
            }
        }

        //省市区的数组
        var arrContry = ['JN480', 'JN481', 'JN482']
        //完整性校验结果集
        var str = '';
        var kksui = newData.fullCheckResult
        for (var i = 0; i < newData.fullCheckResult.length; i++) {

            str += "<tr>";
            // 预警、提示图片（type）
            if (newData.fullCheckResult[i].type == 1) {
                str += "<td><img src='image/warning.png' alt='' class='tipaImg'>" + newData.fullCheckResult[i]
                    .fieldMeaning + " [" + newData.fullCheckResult[i].fieldValve + "]" + "</td>"
            } else {
                str += "<td><img src='image/tips.png' alt='' class='tipaImg'>" + newData.fullCheckResult[i]
                    .fieldMeaning + " [" + newData.fullCheckResult[i].fieldValve + "]" + "</td>"
            }

            str += "<td>" + newData.fullCheckResult[i].reason + "</td>"

            // 输入框0、下拉框1、搜索框2/3（showType）
            if (newData.fullCheckResult[i].showType == "1" && arrContry.indexOf(newData.fullCheckResult[i].fId) > -1) {
                // if (newData.fullCheckResult[i].showType == "1"&& arrContry.in_array(newData.fullCheckResult[i].fId)) {
                str += "<td><div class='dropDownList'><input placeholder='请选择' showType='" + newData.fullCheckResult[i]
                    .showType + "' fId='" + newData.fullCheckResult[i].fId + "' rangeId='" + newData.fullCheckResult[i]
                    .rangeId + "' onmouseover='selectClick(this," + JSON.stringify(kksui[i].rangeList) + ")'  id='DUI" +
                    i + "'type='text' class='cioso inputContent' autocomplete='off' ><input type='hidden' value='" +
                    newData.fullCheckResult[i].rangeId + "'></div>" +
                    "<div class='control-group' style='text-align: center'><div class='controls'><select name='location_p' id='location_p'>" +
                    newData.fullCheckResult[i].fId[0] + "</select><br><select name='location_c' id='location_c'>" +
                    newData.fullCheckResult[i].fId[1] + "</select><br><select name='location_a' id='location_a'>" +
                    newData.fullCheckResult[i].fId[2] + "</select></div></div>" + "</td>"
            } else if (newData.fullCheckResult[i].showType == "1" && arrContry.indexOf(newData.fullCheckResult[i]
                    .fId) <= -1) {
                // else if (newData.fullCheckResult[i].showType == "1" && !arrContry.in_array(newData.fullCheckResult[i].fId)) {

                str += "<td><div class='dropDownList'><input placeholder='请选择' showType='" + newData.fullCheckResult[i]
                    .showType + "' fId='" + newData.fullCheckResult[i].fId + "' rangeId='" + newData.fullCheckResult[i]
                    .rangeId + "' onmouseover='selectClick(this," + JSON.stringify(kksui[i].rangeList) + ")'  id='DUI" +
                    i + "'type='text' class='cioso inputContent' autocomplete='off' ><input type='hidden' value='" +
                    newData.fullCheckResult[i].rangeId + "'></div></td>"
            } else if (newData.fullCheckResult[i].showType == "2" && arrContry.indexOf(newData.fullCheckResult[i].fId) >
                -1) {
                // else if (newData.fullCheckResult[i].showType == "2"&& arrContry.in_array(newData.fullCheckResult[i].fId)) {

                str += "<td><div class='dropDownList'><input placeholder='请搜索' fId='" + newData.fullCheckResult[i].fId +
                    "' rangeId='" + newData
                    .fullCheckResult[i].rangeId + "' onclick='drgclick10(this)'  id='DUI" + i +
                    "'type='text' class='cioso inputContent' autocomplete='off' ><input type='hidden' value='" + newData
                    .fullCheckResult[i].rangeId + "'></div>" +
                    "<div class='control-group' style='text-align: center'><div class='controls'><select name='location_p' id='location_p'>" +
                    newData.fullCheckResult[i].fId[0] + "</select><br><select name='location_c' id='location_c'>" +
                    newData.fullCheckResult[i].fId[1] + "</select><br><select name='location_a' id='location_a'>" +
                    newData.fullCheckResult[i].fId[2] + "</select></div></div>" + "</td>"
            } else if (newData.fullCheckResult[i].showType == "2" && arrContry.indexOf(newData.fullCheckResult[i]
                    .fId) <= -1) {
                // else if (newData.fullCheckResult[i].showType == "2" && !arrContry.in_array(newData.fullCheckResult[i].fId)) {

                str += "<td><div class='dropDownList'><input placeholder='请搜索' fId='" + newData.fullCheckResult[i].fId +
                    "' rangeId='" + newData
                    .fullCheckResult[i].rangeId + "' onclick='drgclick10(this)'  id='DUI" + i +
                    "'type='text' class='cioso inputContent' autocomplete='off' ><input type='hidden' value='" + newData
                    .fullCheckResult[i].rangeId + "'></div></td>"
            } else if (newData.fullCheckResult[i].showType == "3" && arrContry.indexOf(newData.fullCheckResult[i].fId) >
                -1) {
                // else if (newData.fullCheckResult[i].showType == "3"&& arrContry.in_array(newData.fullCheckResult[i].fId)) {
                str += "<td><div class='dropDownList'><input placeholder='请搜索' fId='" + newData.fullCheckResult[i].fId +
                    "' rangeId='" + newData
                    .fullCheckResult[i].rangeId + "' onclick='drgclick(this)'  id='DUI" + i +
                    "'type='text' class='cioso inputContent' autocomplete='off' ><input type='hidden' value='" + newData
                    .fullCheckResult[i].rangeId + "'></div>" +
                    "<div class='control-group' style='text-align: center'><div class='controls'><select name='location_p' id='location_p'>" +
                    newData.fullCheckResult[i].fId[0] + "</select><br><select name='location_c' id='location_c'>" +
                    newData.fullCheckResult[i].fId[1] + "</select><br><select name='location_a' id='location_a'>" +
                    newData.fullCheckResult[i].fId[2] + "</select></div></div>" + "</td>"
            } else if (newData.fullCheckResult[i].showType == "3" && arrContry.indexOf(newData.fullCheckResult[i]
                    .fId) <= -1) {
                // else if (newData.fullCheckResult[i].showType == "3" &&  !arrContry.in_array(newData.fullCheckResult[i].fId)) {
                str += "<td><div class='dropDownList'><input placeholder='请搜索' fId='" + newData.fullCheckResult[i].fId +
                    "' rangeId='" + newData
                    .fullCheckResult[i].rangeId + "' onclick='drgclick(this)'  id='DUI" + i +
                    "'type='text' class='cioso inputContent' autocomplete='off' ><input type='hidden' value='" + newData
                    .fullCheckResult[i].rangeId + "'></div></td>"
            } else if (newData.fullCheckResult[i].showType == "0" && arrContry.indexOf(newData.fullCheckResult[i].fId) >
                -1) {
                // else if (newData.fullCheckResult[i].showType == "0"&& arrContry.in_array(newData.fullCheckResult[i].fId)) {
                str += "<td><div><input fId='" + newData.fullCheckResult[i].fId + "' id='DUI" + i +
                    "'type='text' class='inputContent' autocomplete='off' ></div>" +
                    "<div class='control-group' style='text-align: center;'><div class='controls'><select name='location_p' id='location_p'>" +
                    newData.fullCheckResult[i].fId[0] + "</select><br><select name='location_c' id='location_c'>" +
                    newData.fullCheckResult[i].fId[1] + "</select><br><select name='location_a' id='location_a'>" +
                    newData.fullCheckResult[i].fId[2] + "</select></div></div>" + "</td>"
            } else {
                str += "<td><div><input fId='" + newData.fullCheckResult[i].fId + "' id='DUI" + i +
                    "'type='text' class='inputContent' autocomplete='off' ></div></td>"
            }

            str += "</tr>"

        }
        $("#fullCheckResult").append(str)


        //逻辑性校验结果集
        var str1 = '';
        var yylogn = newData.logicCheckResult;
        for (var i = 0; i < newData.logicCheckResult.length; i++) {
            str1 += "<tr>";
            // 预警、提示图片（type）
            if (newData.logicCheckResult[i].type == 1) {
                str1 += "<td><img src='image/warning.png' alt='' class='tipaImg'>" + newData.logicCheckResult[i]
                    .fieldMeaning + " [" + newData.logicCheckResult[i].fieldValve + "]" + "</td>"
            } else {
                str1 += "<td><img src='image/tips.png' alt='' class='tipaImg'>" + newData.logicCheckResult[i]
                    .fieldMeaning + " [" + newData.logicCheckResult[i].fieldValve + "]" + "</td>"
            }
            str1 += "<td>" + newData.logicCheckResult[i].reason + "</td>"
            // console.log(newData.logicCheckResult[i].showType);
            // 输入框0、下拉框1、搜索框2/3（showType）
            if (newData.logicCheckResult[i].showType == "2") {
                str1 += "<td><div class='dropDownList'><input placeholder='请搜索' fId='" + newData.logicCheckResult[i]
                    .fId + "' rangeId='" + newData
                    .logicCheckResult[
                        i].rangeId + "' onclick='drgclick10(this)' id='LOG" + i +
                    "'type='text' class='ciosio inputContent' autocomplete='off' ><input type='hidden' value='" +
                    newData.logicCheckResult[i].rangeId + "'></div></td>"
            } else if (newData.logicCheckResult[i].showType == "3") {
                str1 += "<td><div class='dropDownList'><input placeholder='请搜索' fId='" + newData.logicCheckResult[i]
                    .fId + "' rangeId='" + newData
                    .logicCheckResult[
                        i].rangeId + "' onclick='drgclick(this)' id='LOG" + i +
                    "'type='text' class='ciosio inputContent' autocomplete='off' ><input type='hidden' value='" +
                    newData.logicCheckResult[i].rangeId + "'></div></td>"
            } else if (newData.logicCheckResult[i].showType == "1") {
                str1 += "<td><div class='dropDownList'><input placeholder='请选择' showType='" + newData.logicCheckResult[
                        i].showType + "' fId='" + newData.logicCheckResult[i].fId + "' rangeId='" + newData
                    .logicCheckResult[i].rangeId + "' onmouseover='selectClick(this," + JSON.stringify(yylogn[i]
                        .rangeList) + ")' id='LOG" + i +
                    "'type='text' class='ciosio inputContent' autocomplete='off' ><input type='hidden' value='" +
                    newData.logicCheckResult[i].rangeId + "'></div></td>"
            } else {
                str1 += "<td><div><input sshowType='" + newData.logicCheckResult[i].showType + "' fId='" + newData
                    .logicCheckResult[i].fId + "' id='LOG" + i +
                    "'type='text' class='inputContent' autocomplete='off' ></div></td>"
            }

            str1 += "</tr>"

        }
        $("#logicCheckResult").append(str1)


        //诊断结果集ICD10
        var str2 = '';
        for (var i = 0; i < newData.drgDiagnoseFieldResult.length; i++) {
            // console.log(newData.drgDiagnoseFieldResult[i].showType);
            str2 += "<tr>";
            if (arrS.indexOf(newData.drgDiagnoseFieldResult[i].nameId) > -1) {
                str2 += "<td ErrData=" + JSON.stringify(newData.drgDiagnoseFieldResult[i]) +
                    " onmouseover='coem(" + JSON.stringify(newData.drgDiagnoseFieldResult[i]) +
                    ",this)' onmouseout='MouseLeave(" + JSON.stringify(newData.drgDiagnoseFieldResult[i]) +
                    ",this)'><div class='firstTd' style='color:red'>" + newData.drgDiagnoseFieldResult[i].fieldName +
                    "<div class='sco' style='color:#444'></div></div></td>"
            } else {
                str2 += "<td ><div class='firstTd'>" + newData.drgDiagnoseFieldResult[i].fieldName +
                    "<div class='sco'></div></div></td>"
            }

            // if (newData.drgDiagnoseFieldResult[i].code != '-') {
                str2 += "<td class='heconellipsis' title='" + newData.drgDiagnoseFieldResult[i].code + "|" + 
                    newData.drgDiagnoseFieldResult[i].name + "'id='" + newData.drgDiagnoseFieldResult[i].codeId + "'>" + 
                    newData.drgDiagnoseFieldResult[i].code + "|" + newData.drgDiagnoseFieldResult[i].name + "</td>"
                str2 += "<td class='heconellipsis' title='" + newData.drgDiagnoseFieldResult[i].ybCode + "|" + 
                    newData.drgDiagnoseFieldResult[i].ybName + "'id='" + newData.drgDiagnoseFieldResult[i].nameId + "'>" + 
                    newData.drgDiagnoseFieldResult[i].ybCode + "|" + newData.drgDiagnoseFieldResult[i].ybName + "</td>"
            // } else {
                // str2 += "<td id='" + newData.drgDiagnoseFieldResult[i].codeId + "'>" + "-" + "</td>"
                // str2 += "<td id='" + newData.drgDiagnoseFieldResult[i].nameId + "'>" + "-" + "</td>"
            // }



            if (newData.drgCheckResult.length > 0) {
                for (var j = 0; j < newData.drgCheckResult.length; j++) {
                    if (newData.drgDiagnoseFieldResult[i].codeId == newData.drgCheckResult[j].fId) {
                        str2 += "<td><div class='dropDownList'><input placeholder='请搜索' codeId='" + newData
                            .drgDiagnoseFieldResult[
                                i].codeId + "' id='DRGDF" + i +
                            "'onmouseover ='drgEvent(this," + JSON.stringify(newData.drgCheckResult[j].rangeList) +
                            ")' type='text' class='inputCon' autocomplete='off' value='' ></div></td>"
                    } else {
                        str2 += "<td><div class='dropDownList'><input placeholder='请搜索' codeId='" + newData
                            .drgDiagnoseFieldResult[
                                i].codeId + "' id='DRGDF" + i +
                            "'onmouseover ='drgEvent(this)' type='text' class='inputCon' autocomplete='off' value='' ></div></td>"
                    }

                }
            } else {
                str2 += "<td><div class='dropDownList'><input placeholder='请搜索' codeId='" + newData
                    .drgDiagnoseFieldResult[
                        i].codeId + "' id='DRGDF" + i +
                    "'onmouseover ='drgEvent(this)' type='text' class='inputCon' autocomplete='off' value='' ></div></td>"
            }

            // <span class='moveUpOrDown'>上移</span> | <span class='moveUpOrDown'>下移</span> |
            str2 +=
                "<td><span class='moveUpOrDown'>置顶</span></td>"
            str2 += "</tr>"
        }
        $("#drgDiagnoseFieldResult").append(str2)

        //手术操作结果集ICD9
        var str3 = '';
        for (var i = 0; i < newData.drgOperationFieldResult.length; i++) {
            str3 += "<tr>";
            if (arrS.indexOf(newData.drgOperationFieldResult[i].codeId) > -1) {
                str3 += "<td onmouseover='coem(" + JSON.stringify(newData.drgOperationFieldResult[i]) +
                    ",this)' onmouseout='MouseLeave(" + JSON.stringify(newData.drgOperationFieldResult[i]) +
                    ",this)' class='tdFist' ErrData='" + JSON.stringify(newData.drgOperationFieldResult[i]) + "'>" +
                    "<div class='firstTd' style='color:red'>" + newData.drgOperationFieldResult[i].fieldName +
                    "<div class='sco' style='color:#444'></div></div></td>"
            } else {
                str3 += "<td><div class='firstTd'>" + newData.drgOperationFieldResult[i].fieldName + "</div></td>"
            }
            // if (newData.drgOperationFieldResult[i].code != '-') {
                str3 += "<td class='heconellipsis' title='" + newData.drgOperationFieldResult[i].code + "|" + 
                    newData.drgOperationFieldResult[i].name + "'id='" + newData.drgOperationFieldResult[i].codeId + "'>" 
                    + newData.drgOperationFieldResult[i].code + "|" + newData.drgOperationFieldResult[i].name + "</td>"
                str3 += "<td class='heconellipsis' title='" + newData.drgOperationFieldResult[i].ybCode + "|" +
                    newData.drgOperationFieldResult[i].ybName + "'id='" + newData.drgOperationFieldResult[i].nameId + "'>" +
                    newData.drgOperationFieldResult[i].ybCode + "|" + newData.drgOperationFieldResult[i].ybName + "</td>"
            // } else {
                // str3 += "<td id='" + newData.drgOperationFieldResult[i].codeId + "'>" + "-" + "</td>"
                // str3 += "<td id='" + newData.drgOperationFieldResult[i].nameId + "'>" + "-" + "</td>"
            // }


            if (newData.drgCheckResult.length > 0) {
                for (var j = 0; j < newData.drgCheckResult.length; j++) {
                    if (newData.drgOperationFieldResult[i].codeId == newData.drgCheckResult[j].fId) {
                        str3 += "<td><div class='dropDownList'><input placeholder='请搜索' codeId='" + newData
                            .drgOperationFieldResult[
                                i].codeId + "' id='DRGOF" + i +
                            "' rangeid='DMB01' onmouseover='drgEventor(this," + JSON.stringify(newData.drgCheckResult[j]
                                .rangeList) + ")' type='text' class='inputCon' autocomplete='off' ></div></td>"
                    } else {
                        str3 += "<td><div class='dropDownList'><input placeholder='请搜索' codeId='" + newData
                            .drgOperationFieldResult[
                                i].codeId + "' id='DRGOF" + i +
                            "' rangeid='DMB01' onmouseover='drgEventor(this)' type='text' class='inputCon' autocomplete='off' ></div></td>"
                    }
                }
            } else {
                str3 += "<td><div class='dropDownList'><input placeholder='请搜索' codeId='" + newData
                    .drgOperationFieldResult[
                        i].codeId + "' id='DRGOF" + i +
                    "' rangeid='DMB01' onmouseover='drgEventor(this)' type='text' class='inputCon' autocomplete='off' ></div></td>"
            }

            // <span class='moveUpOrDown'>上移</span> | <span class='moveUpOrDown'>下移</span> |
            str3 +=
                "<td> <span class='moveUpOrDown'>置顶</span></td>"
            str3 += "</tr>"
        }
        $("#drgOperationFieldResult").append(str3)

    }

    var str = "iid0000ffr";
    var substr = str.match(/(iid=?)(\S*)(?=ffr)/);
    console.log(substr[2]);
    // 提交需要的数据
    var globalVariableData = {};
    var errData;

    function child(d, feeTotal) {
        globalVariableData = d
        var newData = d
        errData = d.drgCheckResult;
        dataShowing(newData, feeTotal);
    }


    //下拉框
    function selectClick(data, rangeList) {

        var obj = data;
        var cuis = obj.id;

        var arrList = [];
        for (var i = 0; i < rangeList.length; i++) {
            var sui = rangeList[i];
            arrList.push({
                value: sui.code,
                label: sui.name
            })
        }

        $("#" + cuis).autocomplete({
            minLength: 0,
            source: arrList,
            mustMatch: true,
            change: function (event, ui) {
                if (!ui.item) {
                    $(this).val('');
                    $("#" + cuis).attr("code", "")
                }
            },
            focus: function (event, ui) {
                // console.log(ui);
                $("#" + cuis).val(ui.item.label);
                $("#" + cuis).attr("code", ui.item.value)
                return false;
            },
            select: function (event, ui) {
                // console.log(ui)
                return false;
            }
            // focus: function () {
            //     return false;
            // },
            // select: function (event, ui) {
            //     $this = $(this);
            //     setTimeout(function () {
            //         $this.blur();
            //     }, 1);
            // }
        }).focus(function () {
            $(this).autocomplete('search')

            return false;
        }).data("ui-autocomplete")._renderItem = function (ul, item) {

            return $("<li>")
                .append("<a>" + item.value + "|" + item.label + "</a>")
                .appendTo(ul);
        };


    }




    function btnclick(data) {
        var obj = data;
        var cuis = obj.id
        var txt = document.getElementById(cuis);
        txt.onkeydown = throttle(handle, 1000, 500)
    }

    // txt.onkeydown = throttle(handle, 1000,500);
    //第一次事件触发，则先执行debounce函数，在执行闭包函数，一步一步执行，第一次以后的每次事件触发都是直接执行debounce函数中的闭包函数

    //函数节流与防抖结合
    function throttle(fn, delay, duration) {
        var timer = null;
        //获取开始时间（时间戳）
        var begin = new Date();
        return function () {
            var context = this;
            var args = arguments;
            //获取当前时间
            var current = new Date();
            clearTimeout(timer);
            //节流
            if (current - begin >= duration) {
                fn.apply(context, args);
                begin = current;
            } else {
                //防抖
                timer = setTimeout(function () {
                    fn.call(context);
                }, delay);
            }
        }
    }

    //事件处理函数(下拉框）
    function handle() {
        var rangeType = $(this).attr("rangeid")
        // var projects = [];
        // var syu = this;
        var id = this.id;

        $("#" + id).autocomplete({
            minLength: 0,
            source: function (request, response) {
                $.ajax({
                    type: "post",
                    url: "/range/rangeResult",
                    data: {
                        "rangeType": rangeType
                    },
                    dataType: "json",
                    success: function (data) {

                        var arrList = [];

                        for (var i = 0; i < data.data.length; i++) {
                            var sui = data.data[i];
                            arrList.push({
                                value: sui.rangeCode,
                                label: sui.rangeName
                            })
                        }
                        response(arrList)
                    }
                })

            },
            focus: function (event, ui) {
                console.log(ui)
                $("#" + id).val(ui.item.label);

                return false;
            },
            select: function (event, ui) {
                console.log(ui)
                return false;
            }
        }).focus(function () {
            $(this).autocomplete('search')

        })

    }


    function drgclick(data) {
        var obj = data;
        var cuis = obj.id
        var txt = document.getElementById(cuis);
        txt.onkeydown = throttle(drghandle, 1000, 500)
    }

    function drghandle() {
        // var drgkeyword = $(this).val()
        // var rangeType = $(this).attr("rangeid")
        // console.log(rangeType)
        // var projects = [];
        var syu = $(this);
        var id = this.id;
        $("#" + id).autocomplete({
            minLength: 1,
            source: function (request, response) {
                if (request.term != '') {
                    $.ajax({
                        type: "post",
                        url: URL_TWO + "queryRange",
                        data: {
                            "showType": "3",
                            "code": request.term
                        },
                        dataType: "json",
                        success: function (data) {
                            var arrList = [];

                            for (var i = 0; i < data.length; i++) {
                                var sui = data[i];
                                arrList.push({
                                    value: sui.code,
                                    label: sui.name,
                                    codename: sui.codename
                                })
                            }
                            response(arrList)
                        }
                    })
                }

            },
            focus: function (event, ui) {

                // $("#" + id).val(ui.item.codename);
                return false;
            },
            select: function (event, ui) {
                $("#" + id).val(ui.item.codename);
                // var ciuo = $("#" + id).parent().parent();
                // ciuo.children("td:eq(1)").text(ui.item.value)
                // ciuo.children("td:eq(2)").text(ui.item.label)
                return false;
            }
        }).focus(function () {
            $(this).autocomplete('search')
        }).data("ui-autocomplete")._renderItem = function (ul, item) {
            return $("<li>")
                .append("<a>" + item.value + "|" + item.label + "</a>")
                .appendTo(ul);
        };


    }

    // 完整性、逻辑性表格里的搜索
    function drgclick10(data) {
        var obj = data;
        var cuis = obj.id
        var txt = document.getElementById(cuis);
        txt.onkeydown = throttle(drghandle10, 1000, 500)
    }

    function drghandle10() {

        // var drgkeyword = $(this).val()
        // var rangeType = $(this).attr("rangeid")
        // console.log(rangeType)
        // var projects = [];
        var syu = $(this);
        var id = this.id;
        $("#" + id).autocomplete({
            minLength: 1,
            source: function (request, response) {
                if (request.term != '') {
                    $.ajax({
                        type: "post",
                        url: URL_TWO + "queryRange",
                        data: {
                            "showType": "2",
                            "code": request.term
                        },
                        dataType: "json",
                        success: function (data) {
                            var arrList = [];

                            for (var i = 0; i < data.length; i++) {
                                var sui = data[i];
                                arrList.push({
                                    value: sui.code,
                                    label: sui.name,
                                    codeName: sui.codename
                                })
                            }
                            response(arrList)
                        }
                    })
                }

            },
            focus: function (event, ui) {

                $("#" + id).val(ui.item.codeName);
                return false;
            },
            select: function (event, ui) {
                $("#" + id).val(ui.item.codeName);
                var ciuo = $("#" + id).parent().parent();
                // ciuo.children("td:eq(1)").text(ui.item.value)
                // ciuo.children("td:eq(2)").text(ui.item.label)
                return false;
            }
        }).focus(function () {
            $(this).autocomplete('search')
        }).data("ui-autocomplete")._renderItem = function (ul, item) {
            return $("<li>")
                .append("<a>" + item.value + "|" + item.label + "</a>")
                .appendTo(ul);
        };


    }

    //DRG修改
    //ICD-10搜索
    function drgEvent(data, siro) {
        var obj = data;
        var cuis = obj.id
        var txt = document.getElementById(cuis);
        drgEventhandle(data, siro)
        // txt.onkeydown = throttle(drgEventhandle, 1000, 500)

    }

    function drgEventhandle(data, rangList) {
        // console.log(data.sui)
        // var drgkeyword = $(this).val()
        // var rangeType = $(this).attr("rangeid")
        // console.log(rangeType)

        var syu = $(this);
        // var id = this.id;
        var id = data.id
        $("#" + id).autocomplete({
            minLength: 0,
            source: function (request, response) {
                if (request.term != '') {
                    $.ajax({
                        type: "post",
                        url: URL_TWO + "queryRange",
                        data: {
                            "showType": "2",
                            "code": request.term
                        },
                        dataType: "json",
                        success: function (data) {
                            var arrList = [];

                            for (var i = 0; i < data.length; i++) {
                                var sui = data[i];
                                arrList.push({
                                    value: sui.code,
                                    label: sui.name,
                                    codeName: sui.codename,
                                    fist: ''
                                })
                            }
                            response(arrList)
                        }
                    })
                } else if (rangList !== undefined) {
                    var arrList = [];
                    for (var i = 0; i < rangList.length; i++) {
                        var sui = rangList[i];
                        arrList.push({
                            value: sui.code,
                            label: sui.name,
                            codeName: sui.codename,
                            fist: "优先选择",
                        })
                    }
                    response(arrList)
                }

            },
            focus: function (event, ui) {
                console.log(ui)
                // $("#" + id).val(ui.item.label);
                // $("#" + id).val(ui.item.codeName);
                return false;
            },
            select: function (event, ui) {
                console.log(ui)
                // $("#" + id).val(ui.item.label);
                $("#" + id).val(ui.item.codeName);

                var ciuo = $("#" + id).parent().parent();
                ciuo.children("td:eq(1)").text(ui.item.value)
                ciuo.children("td:eq(2)").text(ui.item.label)
                return false;
            }
        }).focus(function () {
            $(this).autocomplete('search')
        }).data("ui-autocomplete")._renderItem = function (ul, item) {
            return $("<li>")

                .append("<a>" + item.fist + item.value + "|" + item.label + "</a>")
                .appendTo(ul);
        };


    }

    //ICD-9搜索
    function drgEventor(data, skui) {

        var obj = data;
        var cuis = obj.id
        var txt = document.getElementById(cuis);
        drgEventorhandle(data, skui)
        // setTimeout(function () {
        //     if (txt.value > 0) {
        //         console.log("1111")
        //         // txt.onkeydown = throttle(drgEventorhandle, 1000, 500)
        //         drgEventorhandle(data)
        //         return
        //     } else {
        //         console.log("22222")
        //     }

        // }, 1000)

    }

    function drgEventorhandle(data, rangList) {
        var syu = $(this);
        // var id = this.id;
        var id = data.id
        $("#" + id).autocomplete({
            minLength: 0,
            source: function (request, response) {

                if (request.term != '') {
                    $.ajax({
                        type: "post",
                        url: URL_TWO + "queryRange",
                        data: {
                            "showType": "3",
                            "code": request.term
                        },
                        dataType: "json",
                        success: function (data) {

                            var arrList = [];

                            for (var i = 0; i < data.length; i++) {
                                var sui = data[i];
                                console.log(sui.code)
                                arrList.push({
                                    value: sui.code,
                                    label: sui.name,
                                    codeName: sui.codename,
                                    fist: ''
                                })
                            }
                            response(arrList)
                        }
                    })
                } else if (rangList !== undefined) {
                    var arrList = [];

                    for (var i = 0; i < rangList.length; i++) {
                        var sui = rangList[i];

                        arrList.push({
                            value: sui.code,
                            label: sui.name,
                            codeName: sui.codename,
                            fist: '优先选择'
                        })
                    }
                    response(arrList)
                }

            },
            focus: function (event, ui) {
                console.log(ui)
                $("#" + id).val(ui.item.codeName);
                return false;
            },
            select: function (event, ui) {
                console.log(ui)
                $("#" + id).val(ui.item.codeName);

                var ciuo = $("#" + id).parent().parent();
                ciuo.children("td:eq(1)").text(ui.item.value)
                ciuo.children("td:eq(2)").text(ui.item.label)
                return false;
            }
        }).focus(function () {
            $(this).autocomplete('search')
        }).data("ui-autocomplete")._renderItem = function (ul, item) {
            return $("<li>")
                .append("<a>" + item.fist + item.value + "|" + item.label + "</a>")
                .appendTo(ul);
        };


    }



    //校验
    function getDRGContent() {
        var fulMessage = {};
        var DrgFull = ["JN48", "JN50", "JN54", "JN58", "JN62", "JN66", "JN70", "JN74", "JN78", "JN82", "JN86", "JN90",
            "JN107", "JN111", "JN115", "JN119", "JN121", "JN123", "JN125", "JN139", "JN153", "JN167", "JN181",
            "JN195", "JN209", "JN223", "JN237", "JN251"
        ]
        //完整性校验
        //tbody的tr
        var trs = $("#fullCheckResult").children("tr");

        // console.log(trs)
        for (var i = 0; i < trs.length; i++) {
            var inputCon = trs.eq(i).children('td:eq(2)').children(":first").children(":first");
            var inputKey = inputCon.attr("fId")

            if (inputCon.attr("showType") == 1) {
                fulMessage[inputKey] = inputCon.attr("code")
            } else {
                fulMessage[inputKey] = inputCon.val()
            }
        }

        //逻辑性校验
        //tbody的tr
        var trs1 = $("#logicCheckResult").children("tr");
        // console.log(trs1)
        for (var i = 0; i < trs1.length; i++) {
            var inputCon = trs1.eq(i).children('td:eq(2)').children(":first").children(":first");
            var inputKey = inputCon.attr("fId")
            if (inputCon.attr("showType") == 1) {
                fulMessage[inputKey] = inputCon.attr("code")
            } else {
                fulMessage[inputKey] = inputCon.val()
            }
        }
        var Logic = [];

        for (var i = 0; i < DrgFull.length; i++) {
            if (Object.prototype.hasOwnProperty.call(fulMessage, DrgFull[i]) == true) {

                if (fulMessage[DrgFull[i]] != '') {
                    Logic.push(DrgFull[i])
                }
            }

        }
        // console.log(fulMessage)
        var DRGfull = {};
        var codeArray = ["JN50", "JN54", "JN58", "JN62", "JN66", "JN70", "JN74", "JN78", "JN82", "JN86", "JN90",
            "JN107", "JN111", "JN115", "JN119", "JN121", "JN123",
        ]

        // DRG表格d code/name 对应的字段
        var NameAp = ["JN47", "JN49", "JN53", "JN57", "JN61", "JN65", "JN69", "JN73", "JN77", "JN81", "JN85", "JN89", ];

        var kuioOP = ["JN126", "JN140", "JN154", "JN168", "JN182", "JN196", "JN210", "JN224", "JN238", "JN252"];
        //DRG校验
        //tbody的tr
        var trs2 = $("#drgDiagnoseFieldResult").children("tr");
        // console.log(trs2)
        for (var i = 0; i < trs2.length; i++) {
            // var inputCon = trs2.eq(i).children('td:eq(3)').children(":first");
            // var inputKey = inputCon.attr("codeId")
            for (var j = 0; j < codeArray.length; j++) {
                if (i == j) {
                    var inputKey = codeArray[j];
                    var kuiKey = NameAp[j];
                    // var inputCode = trs2.eq(i).children('td:eq(1)').html()
                    var inputCon = trs2.eq(i).children('td:eq(3)').children(":first").children(":first").val();
                    var hhinputConCode = trs2.eq(i).children('td:eq(2)').html();
                    // var hhinputConName = trs2.eq(i).children('td:eq(2)').html();
                    if (inputCon != '') {
                        DRGfull[inputKey] = inputCon
                    } else if (hhinputConCode != '-' && inputCon == '') {
                        DRGfull[inputKey] = hhinputConCode

                    } else if (hhinputConCode == '-' && inputCon == '') {
                        DRGfull[kuiKey] = "-"
                    }

                }
            }
        }

        var operationArray = ["JN125", "JN139", "JN153", "JN167", "JN181", "JN195", "JN209", "JN223", "JN237", "JN251"]

        var trs3 = $("#drgOperationFieldResult").children("tr");
        for (var i = 0; i < trs3.length; i++) {
            for (var o = 0; o < operationArray.length; o++) {
                if (i == o) {
                    var inputKey = operationArray[o];
                    var kuiKey = kuioOP[o];

                    // var inputCon = trs3.eq(i).children('td:eq(1)').html()
                    var inputCon = trs3.eq(i).children('td:eq(3)').children(":first").children(":first").val();
                    var hhinputConCode = trs3.eq(i).children('td:eq(2)').html();
                    // var hhinputConName = trs3.eq(i).children('td:eq(2)').html();

                    if (inputCon != '') {
                        fulMessage[inputKey] = inputCon
                    } else if (hhinputConCode != '-' && inputCon == '') {
                        fulMessage[inputKey] = hhinputConCode

                    } else if (hhinputConCode == '-' && inputCon == '') {
                        fulMessage[kuiKey] = "-"
                    }
                }
            }
            var inputCon = trs3.eq(i).children('td:eq(1)').html()
            var inputCon = trs3.eq(i).children('td:eq(3)').children(":first").children(":first").val();
            DRGfull[inputKey] = inputCon

        }
        if (typeof Object.assign != 'function') {
            Object.assign = function (target) {
                'use strict';
                if (target == null) {
                    throw new TypeError('Cannot convert undefined or null to object');
                }

                target = Object(target);
                for (var index = 1; index < arguments.length; index++) {
                    var source = arguments[index];
                    if (source != null) {
                        for (var key in source) {
                            if (Object.prototype.hasOwnProperty.call(source, key)) {
                                target[key] = source[key];
                            }
                        }
                    }
                }
                return target;
            };
        }
        console.log(DRGfull)
        console.log(Logic.length)
        if (Logic.length == 0) {
            Object.assign(fulMessage, DRGfull);
        } else {
            for (var i = 0; i < Logic.length; i++) {
                delete DRGfull[Logic[i]]
                // console.log(DRGfull[Logic[i]])
            }
            Object.assign(fulMessage, DRGfull);
        }



        fulMessage = JSON.stringify(fulMessage)
        var mId = $("#mId").text();
        $.ajax({
            type: "post",
            url: URL_TWO + "recordCheck",
            data: {
                "recordInfo": fulMessage,
                "recordId": mId
            },
            dataType: "json",
            success: function (data) {
                // console.log(data.auditRuleResults)
                // newData = data.auditRuleResults
                // console.log(data)

                // $('#inputAll').val(JSON.stringify(data));
                // 数据
                console.log(data.auditRuleResults)
                var segmentData = JSON.stringify(data.auditRuleResults);
                // var newData = JSON.parse(segmentData)
                var newData = eval('(' + segmentData + ')');
                // newData = newData.auditRuleResults;
                // window.location.reload()
                // console.log(newData)

                $("#unreasontext").empty();
                $("#fullCheckResult").children().remove()
                $("#logicCheckResult").children().remove()
                $("#drgDiagnoseFieldResult").children().remove()
                $("#drgOperationFieldResult").children().remove()


                dataShowing(newData);
            }
        })

    }



    var submitResult = "";
    //提交
    function commitDRGContent() {
        // 数据
        // var segmentData = $('#inputAll').val();
        // var newData = JSON.parse(segmentData)
        // var newData = eval('(' + segmentData + ')');
        // newData = newData.auditRuleResults;
        // console.log(newData)


        var newData = globalVariableData

        //type == 1预警
        var allType = [];
        for (var i = 0; i < newData.fullCheckResult.length; i++) {
            allType.push(newData.fullCheckResult[i].type)
        }
        for (var i = 0; i < newData.logicCheckResult.length; i++) {
            allType.push(newData.logicCheckResult[i].type)
        }
        for (var i = 0; i < newData.drgCheckResult.length; i++) {
            allType.push(newData.drgCheckResult[i].type)
        }


        if (allType.indexOf('1') > -1) {
            // if (!allType.in_array('1')) {
            submitResult = "-1";
            alert("请修改页面中预警违规项");
        } else {
            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            parent.layer.close(index);
        }
    }


    //鼠标经过事件
    let testFunc = debounce(function (item) {
        let sui = $(this).find(".sco")
        var xui = $(this).attr('ErrData');
        var d = JSON.parse(xui)
        var pageX, pageY;
        pageX = item.x + "px";
        pageY = item.y + "px";
        sui.empty()
        for (var i = 0; i < errData.length; i++) {
            if (errData[i].fId == d.nameId) {
                sui.append("<div class='popover' style='top:" + pageY + ";left:" + pageX +
                    ";display:block'>" + errData[i].reason + "</div>")
            } else if (errData[i].fId == d.codeId) {
                sui.append("<div class='popover' style='top:" + pageY + ";left:" + pageX +
                    ";display:block'>" + errData[i].reason + "</div>")
            }
        }
    }, 250)

    function coem(d, e) {

        // e.addEventListener("mousemove",function(event){
        //     pageX = event.x+"px";
        //     pageY= event.y+"px";
        //     sui.empty()
        //     sui.append( "<div class='popover' style='top:"+pageY+";left:"+pageX+";display:block'>【{ZA2}】不用于根本死因的编码，因此当患者死亡后，不可作为【主要诊断=编码】。</div>")
        // },true)
        if (errData.length > 0) {
            e.addEventListener('mousemove', testFunc, true)
        }

    }

    function debounce(func, wait) {
        let timeout = null
        return function () {
            let context = this,
                args = arguments;
            clearTimeout(timeout);
            timeout = setTimeout(function () {
                func.apply(context, args);
            }, wait);
        };
    };
    // 实际想绑定在 scroll 事件上的 handler

    function MouseLeave(d, e) {
        let sui = $(e).find(".sco")
        e.removeEventListener("mousemove", testFunc)
        setTimeout(() => {
            sui.empty()
        }, 250)
    }
</script>

</html>